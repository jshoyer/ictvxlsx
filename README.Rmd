
My goal here
is to make it a little bit easier
to use tables
from the ICTV
via a dedicated R package.

```{r}
library(readxl)
library(dplyr)

msl2022 <-
  read_excel("ICTV_Master_Species_List_2022_MSL38.v3.xlsx",
             col_types = "text",
             sheet = 2, .name_repair = "universal")

vmr2022 <-
  read_excel("VMR_MSL38_v3.xlsx",
             col_types = "text",
             sheet = 1, .name_repair = "universal")

vmr2022_e <- filter(vmr2022,
                    Exemplar.or.additional.isolate == "E") |>
  select(-Exemplar.or.additional.isolate)

vmr2022_e_slim <- transmute(vmr2022_e,
                            Family, Genus, Species,
                            name = Virus.name.s.,
                            abbrev = Virus.name.abbreviation.s.,
                            isolate = Virus.isolate.designation,
                            genbank = Virus.GENBANK.accession,
                            refseq = Virus.REFSEQ.accession)
## Genome.coverage, Genome.composition, Host.source

vmr2022_e_slim2 <- select(vmr2022_e_slim,
                          -Family, -Genus)

msl2022_e <- left_join(msl2022, vmr2022_e_slim2,
                       by = "Species")

## Top down: ######################################################################
monodna <- filter(msl2022_e, Realm == "Monodnaviria") |>
    select(-Realm, -Subrealm)

as.data.frame(with(monodna, table(abbrev))) |>
    filter(Freq > 1) |>
    left_join(vmr2022_e_slim) |>
    select(abbrev, name, Species, Genus)

## Bottom up: ######################################################################
filter(vmr2022_e_slim2, abbrev == "AYVV") ## not quite, because

## many abbreviations have an extra identifier tacked on
filter(vmr2022_e_slim,
       Genus == "Begomovirus",
       ##Family == "Geminiviridae",
       grepl("/", abbrev)) |>
    select(name, abbrev, isolate)

filter(vmr2022_e_slim,
       grepl("Hualian", name)) |>
    select(name, abbrev, isolate)

## One-letter abbreviation used, not two-letter abbreviation
filter(vmr2022_e_slim,
       grepl("Japan", name)) |>
    select(name, abbrev, isolate)
filter(vmr2022_e_slim,
       grepl("JP", abbrev)) |>
    select(name, abbrev, isolate)

######################################################################

filter(vmr2022_e, Genus == "Umbravirus") |>
    select(Species, Virus.name.abbreviation.s.)
## Subfamily Calvusvirinae
## Same:
filter(vmr2022_e, Subfamily == "Calvusvirinae") |>
    select(Genus, Subgenus, Species, Virus.name.abbreviation.s.)

write.csv(
filter(vmr2022_e, Family == "Tombusviridae") |>
    select(Subfamily, Genus, Subgenus, Species,
           Virus.name.s.,
           Virus.name.abbreviation.s.)
, "tombusviridae_2022.csv")

filter(vmr2022_e, Virus.name.abbreviation.s. == "WMV") |>
    select(Species, Host.source, Genome.composition)
```
